<!DOCTYPE html>
<html>
<head>
  <title>SIWE Consent Sign</title>
</head>
<body>
  <h3>Proof of Funds Consent</h3>
  <button id="signBtn">Sign Consent Message</button>
  <p id="result"></p>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    // SIWE message for PoF consent
    const message = `pof-group-2025.example.com wants you to sign in with your Ethereum account:
0x68369a6Bb5c429696BF91C4Fe134C0Abc48d6bB6

I consent to include my wallet in the PoF Group 2025 proof of funds aggregate for verification as of 2025-09-18 22:02 PDT.

URI: mailto:xyz123@gmail.com
Version: 1
Chain ID: 1
Nonce: p8vT3mQ6x9
Issued At: 2025-09-18T22:02:24-07:00`;

    // Function to sign the message
    async function signMessage() {
      let provider;
      if (typeof window.ethereum !== 'undefined') {
        provider = window.ethereum;
      } else if (typeof window.web3 !== 'undefined') {
        provider = window.web3.currentProvider;
      } else {
        document.getElementById('result').innerHTML = 'Error: MetaMask not detected! Ensure MetaMask is installed, unlocked, and enabled in Firefox.';
        console.error('No provider found. window.ethereum:', window.ethereum, 'window.web3:', window.web3);
        return;
      }

      try {
        const accounts = await provider.request({ method: 'eth_requestAccounts' });
        const address = accounts[0];
        const finalMessage = message.replace('[Your Wallet Address]', address);
        const hexMessage = '0x' + ethers.utils.hexlify(ethers.utils.toUtf8Bytes(finalMessage)).slice(2);
        const signature = await provider.request({
          method: 'personal_sign',
          params: [hexMessage, address],
        });
        document.getElementById('result').innerHTML = `Signature: ${signature}<br>Address: ${address}`;
        console.log('Signature successful:', signature);
      } catch (error) {
        document.getElementById('result').innerHTML = `Error: ${error.message}`;
        console.error('Signing error:', error);
      }
    }

    document.getElementById('signBtn').onclick = signMessage;
    console.log('Provider check - window.ethereum:', window.ethereum, 'window.web3:', window.web3');
  </script>
</body>
</html>
